<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºç‚¹åç³»ç»Ÿ</title>
    <style>
        body {
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 30%, #E0F6FF 60%, #B0E0E6 100%);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1 {
            color: #ff6b6b;
            font-size: 3.5rem;
            margin: 2rem 0;
            text-shadow: 3px 3px 0px #fff, 6px 6px 10px rgba(0,0,0,0.1);
            animation: bounce 2s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        #canvas {
            border: 8px solid #fff;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2), 0 5px 20px rgba(255,107,107,0.3);
            background: linear-gradient(180deg, rgba(255,255,255,0.98) 0%, rgba(254,207,239,0.3) 100%);
            margin-bottom: 2rem;
            max-width: 90vw;
            /* ç§»é™¤å†²çªçš„é«˜åº¦è®¾ç½®ï¼Œè®©JavaScriptå®Œå…¨æ§åˆ¶ */
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
            max-width: 500px;
            padding: 0 1rem;
        }
        
        #startBtn {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            border: 3px solid #fff;
            padding: 1.2rem 2.5rem;
            font-size: 1.8rem;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2), 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Comic Sans MS', cursive;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 300px;
        }
        
        #startBtn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        #startBtn:active {
            transform: translateY(0) scale(0.98);
        }
        
        #speedSlider {
            width: 350px;
            height: 12px;
            border-radius: 10px;
            background: linear-gradient(to right, #ffb3ba 0%, #ffb3ba 50%, #ddd 50%, #ddd 100%);
            outline: none;
            -webkit-appearance: none;
            width: 100%;
            max-width: 350px;
        }
        
        #speedSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff 0%, #fff 30%, #45b7d1 30%, #45b7d1 100%);
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: 3px solid #fff;
        }
        
        #speedSlider::-moz-range-thumb {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff 0%, #fff 30%, #45b7d1 30%, #45b7d1 100%);
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 3px solid #fff;
        }
        
        .speed-label {
            color: #ff6b6b;
            font-size: 1.4rem;
            font-weight: bold;
            text-shadow: 1px 1px 0px #fff;
        }
        
        #fileInput {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,179,186,0.5) 100%);
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            font-family: 'Comic Sans MS', cursive;
            width: 100%;
            max-width: 250px;
        }
        
        #fileInput:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* å¼¹çª—æ ·å¼ */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .popup-overlay.active {
            display: flex;
        }
        
        .popup-overlay.show {
            opacity: 1;
        }
        
        /* ç¡®ä¿å¼¹çª—å…³é—­æ—¶ä¸æ˜¾ç¤º */
        .popup-overlay:not(.active) {
            display: none !important;
        }
        
        .popup-content {
            background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            border: 5px solid #4ecdc4;
            max-width: 500px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            position: relative;
        }
        
        .popup-overlay.show .popup-content {
            transform: scale(1);
        }
        
        .popup-title {
            color: #ff6b6b;
            font-size: 2.2rem;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.8);
        }
        
        .popup-name {
            color: #4CAF50;
            font-size: 3rem;
            margin: 20px 0;
            font-weight: bold;
            text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.8);
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .popup-message {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        .popup-close-btn {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            border: 3px solid #fff;
            padding: 12px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            font-family: 'Comic Sans MS', cursive;
            font-weight: bold;
        }
        
        .popup-close-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .popup-close-btn:active {
            transform: translateY(0) scale(0.98);
        }
        
        /* å“åº”å¼å¼¹çª— */
        @media (max-width: 768px) {
            .popup-content {
                padding: 30px 20px;
                border-radius: 20px;
                border-width: 4px;
            }
            
            .popup-title {
                font-size: 1.8rem;
            }
            
            .popup-name {
                font-size: 2.5rem;
            }
            
            .popup-message {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 480px) {
            .popup-content {
                padding: 25px 15px;
                border-radius: 15px;
                border-width: 3px;
            }
            
            .popup-title {
                font-size: 1.5rem;
            }
            
            .popup-name {
                font-size: 2rem;
            }
            
            .popup-message {
                font-size: 1rem;
            }
            
            .popup-close-btn {
                padding: 10px 25px;
                font-size: 1.1rem;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ - ç§»åŠ¨è®¾å¤‡ */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
                margin: 1.5rem 0;
                text-shadow: 2px 2px 0px #fff, 4px 4px 8px rgba(0,0,0,0.1);
            }
            
            #canvas {
                border: 6px solid #fff;
                border-radius: 20px;
                width: 95vw;
                height: auto;
                aspect-ratio: 2/1;
            }
            
            .controls {
                gap: 1.2rem;
                padding: 0 0.8rem;
            }
            
            #startBtn {
                padding: 1rem 2rem;
                font-size: 1.5rem;
                border: 2px solid #fff;
                max-width: 250px;
            }
            
            #speedSlider {
                height: 10px;
            }
            
            #speedSlider::-webkit-slider-thumb {
                width: 30px;
                height: 30px;
                border: 2px solid #fff;
            }
            
            #speedSlider::-moz-range-thumb {
                width: 30px;
                height: 30px;
                border: 2px solid #fff;
            }
            
            .speed-label {
                font-size: 1.2rem;
            }
            
            #fileInput {
                padding: 0.7rem 1.2rem;
                font-size: 1rem;
                border: 2px solid #fff;
                max-width: 200px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
                margin: 1rem 0;
                text-shadow: 1px 1px 0px #fff, 2px 2px 4px rgba(0,0,0,0.1);
            }
            
            #canvas {
                border: 4px solid #fff;
                border-radius: 15px;
            }
            
            .controls {
                gap: 1rem;
            }
            
            #startBtn {
                padding: 0.8rem 1.5rem;
                font-size: 1.3rem;
            }
            
            #speedSlider::-webkit-slider-thumb {
                width: 25px;
                height: 25px;
            }
            
            #speedSlider::-moz-range-thumb {
                width: 25px;
                height: 25px;
            }
            
            .speed-label {
                font-size: 1.1rem;
            }
            
            #fileInput {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸ² éšæœºç‚¹å</h1>
    <canvas id="canvas" width="800" height="400"></canvas>
    <div class="controls">
        <button id="startBtn">å¼€å§‹ç‚¹å</button>
        <input type="range" id="speedSlider" min="1" max="100" value="50">
        <div class="speed-label">é€Ÿåº¦: <span id="speedValue">50</span></div>
        <input type="file" id="fileInput" accept=".xlsx, .xls">
    </div>
    
    <!-- å¼¹çª—ç»„ä»¶ -->
    <div id="resultPopup" class="popup-overlay">
        <div class="popup-content">
            <h2 class="popup-title">ğŸ‰ æ­å–œé€‰ä¸­</h2>
            <div class="popup-name" id="popupSelectedName">--</div>
            <p class="popup-message">è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç»§ç»­</p>
            <button id="popupCloseBtn" class="popup-close-btn">ç¡®å®š</button>
        </div>
    </div>
    <script>
        // ç”Ÿæˆ60ä¸ªæ¨¡æ‹Ÿå­¦ç”Ÿå§“å
        const studentNames = [];
        
        // æ‰©å±•å¸¸è§å§“æ°åˆ—è¡¨ï¼ˆå¢åŠ æ›´å¤šå¸¸è§ä¸­å›½å§“æ°ï¼‰
        const familyNames = [
            'å¼ ', 'ç‹', 'æ', 'åˆ˜', 'é™ˆ', 'æ¨', 'èµµ', 'é»„', 'å‘¨', 'å´',
            'å¾', 'å­™', 'èƒ¡', 'æœ±', 'é«˜', 'æ—', 'ä½•', 'éƒ­', 'é©¬', 'ç½—',
            'æ¢', 'å®‹', 'éƒ‘', 'è°¢', 'éŸ©', 'å”', 'å†¯', 'äº', 'è‘£', 'è§',
            'ç¨‹', 'æ›¹', 'è¢', 'é‚“', 'è®¸', 'å‚…', 'æ²ˆ', 'æ›¾', 'å½­', 'å•'
        ];
        
        // åŒºåˆ†æ€§åˆ«åå­—åˆ—è¡¨
        const maleGivenNames = [
            'ä¼Ÿ', 'å¼º', 'å†›', 'å‹‡', 'æ°', 'æ¶›', 'ç£Š', 'è¶…', 'æ˜', 'åˆš',
            'è¾‰', 'é£', 'é˜³', 'æ™¨', 'å®‡', 'è½©', 'æµ©', 'åš', 'ç‘', 'æ³½',
            'å­è½©', 'æµ©ç„¶', 'ä¿Šæ°', 'å®‡èˆª', 'å­æ¶µ', 'å­è±ª', 'é›¨æ³½', 'æµ©å®‡', 'åšæ–‡', 'å®‡è½©'
        ];
        
        const femaleGivenNames = [
            'èŠ³', 'å¨œ', 'æ•', 'é™', 'ä¸½', 'å¨Ÿ', 'è‰³', 'ç²', 'ç§€', 'éœ',
            'æ…§', 'é¢–', 'èŠ³', 'ç‡•', 'å©·', 'è‰', 'å…°', 'ç´', 'æ¢…', 'ä¸¹',
            'é›¨æ¡', 'æ¢¦çª', 'å¿ƒæ€¡', 'ä½³æ€¡', 'é›¨å˜‰', 'æ€çª', 'è¯—çª', 'æ¢¦æ¶µ', 'é›ª', 'æ¢¦'
        ];
        
        // studentNameså·²ç»åœ¨ä¸Šé¢å£°æ˜å¹¶åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„
        
        // æ·»åŠ å›ºå®šçš„æµ‹è¯•å§“åä½œä¸ºä¿åº•
        const fixedNames = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«', 'å‘¨ä¹', 'å´å'];
        studentNames.push(...fixedNames);
        
        // ç”Ÿæˆæ›´å¤šéšæœºå§“å
        const generatedNames = new Set(fixedNames); // åˆå§‹åŒ…å«å›ºå®šå§“åï¼Œç¡®ä¿ä¸é‡å¤
        
        while (generatedNames.size < 60) {
            // éšæœºé€‰æ‹©å§“æ°
            const familyName = familyNames[Math.floor(Math.random() * familyNames.length)];
            
            // éšæœºç¡®å®šæ€§åˆ«ï¼ˆ50%æ¦‚ç‡ï¼‰
            const isMale = Math.random() > 0.5;
            const givenNamesPool = isMale ? maleGivenNames : femaleGivenNames;
            
            // éšæœºé€‰æ‹©åå­—
            const givenName = givenNamesPool[Math.floor(Math.random() * givenNamesPool.length)];
            
            // ç»„åˆå§“å
            let fullName = familyName + givenName;
            
            // 20%çš„æ¦‚ç‡æ·»åŠ æ€§åˆ«æ ‡è¯†
            if (Math.random() > 0.8) {
                fullName += isMale ? 'åŒå­¦' : 'åŒå­¦';
            }
            
            // 30%çš„æ¦‚ç‡æ·»åŠ ç­å·æˆ–å­¦å·æ ‡è¯†
            if (Math.random() > 0.7) {
                const classNum = Math.floor(Math.random() * 3) + 1; // 1-3ç­
                const studentNum = Math.floor(Math.random() * 60) + 1; // 1-60å·
                fullName += `(${classNum}ç­${studentNum}å·)`;
            }
            
            generatedNames.add(fullName);
        }
        
        // æ¸…ç©ºå¹¶æ›´æ–°studentNamesæ•°ç»„
        studentNames.length = 0; // æ¸…ç©ºæ•°ç»„
        studentNames.push(...Array.from(generatedNames));
        
        // æ‰“ä¹±å§“åé¡ºåº
        studentNames.sort(() => Math.random() - 0.5);
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // å“åº”å¼Canvaså¤„ç†
        function resizeCanvas() {
            const containerWidth = canvas.parentElement.clientWidth;
            const maxWidth = Math.min(containerWidth * 0.95, 800);
            
            // è®¾ç½®Canvasçš„å®é™…ç»˜å›¾å°ºå¯¸ï¼ˆé‡è¦ï¼ï¼‰
            canvas.width = maxWidth;
            
            // ä¿æŒå®½é«˜æ¯”
            const aspectRatio = 2; // 800:400
            canvas.height = maxWidth / aspectRatio;
            
            // è®¾ç½®CSSæ ·å¼å°ºå¯¸
            canvas.style.width = `${maxWidth}px`;
            canvas.style.height = `${maxWidth / aspectRatio}px`;
            
            // è°ƒæ•´å­—ä½“å¤§å°ä»¥é€‚åº”Canvas - å¢å¤§å­—ä½“å°ºå¯¸
            const fontSize = Math.min(72, Math.max(36, maxWidth * 0.09));
            // ä½¿ç”¨æ›´é€‚åˆä¸­æ–‡çš„å­—ä½“ï¼Œç»Ÿä¸€ä½¿ç”¨åŒå¼•å·
            ctx.font = `${fontSize}px "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
        }
        
        // åˆå§‹åŒ–å’Œç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // ç§»é™¤è°ƒè¯•ä»£ç 
        let isRolling = false;
        let currentIndex = 0;
        let speed = 50;
        let lastTime = 0;
        let selectedName = '';
        
        // è·å–å¼¹çª—å…ƒç´ 
        const resultPopup = document.getElementById('resultPopup');
        const popupSelectedName = document.getElementById('popupSelectedName');
        const popupCloseBtn = document.getElementById('popupCloseBtn');
        
        // æ˜¾ç¤ºå¼¹çª—å‡½æ•°
        function showPopup(name) {
            if (popupSelectedName && resultPopup) {
                popupSelectedName.textContent = name;
                // å…ˆæ¿€æ´»æ˜¾ç¤º
                resultPopup.classList.add('active');
                // è§¦å‘é‡æ’
                resultPopup.offsetHeight;
                // å†æ·»åŠ åŠ¨ç”»æ•ˆæœ
                resultPopup.classList.add('show');
                console.log('å¼¹çª—å·²æ˜¾ç¤ºï¼Œé€‰ä¸­å§“å:', name);
            }
        }
        
        // éšè—å¼¹çª—å‡½æ•°
        function hidePopup() {
            if (resultPopup) {
                resultPopup.classList.remove('show');
                // ç­‰å¾…åŠ¨ç”»å®Œæˆåå†éšè—
                setTimeout(() => {
                    resultPopup.classList.remove('active');
                    console.log('å¼¹çª—å·²éšè—');
                }, 300);
            }
        }
        
        // å¼¹çª—å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
        if (popupCloseBtn) {
            popupCloseBtn.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                hidePopup();
            });
        }
        
        // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
        if (resultPopup) {
            resultPopup.addEventListener('click', function(event) {
                // åªæœ‰å½“ç‚¹å‡»çš„æ˜¯é®ç½©å±‚æœ¬èº«è€Œä¸æ˜¯å†…å®¹æ—¶æ‰å…³é—­
                if (event.target === resultPopup) {
                    hidePopup();
                }
            });
        }
        
        // æŒ‰ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && resultPopup && resultPopup.classList.contains('active')) {
                hidePopup();
            }
        });
        
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯è‰²ä»¥ä¾¿æ›´å¥½åœ°çœ‹åˆ°æ–‡æœ¬
            ctx.fillStyle = 'rgba(255, 255, 255, 1)'; // ä¸é€æ˜çš„èƒŒæ™¯ï¼Œç¡®ä¿æ–‡æœ¬å¯è§
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ä¿å­˜å½“å‰ä¸Šä¸‹æ–‡çŠ¶æ€
            ctx.save();
            
            // æ·»åŠ é¢å¤–çš„å®‰å…¨æ£€æŸ¥ï¼Œç¡®ä¿studentNameså­˜åœ¨ä¸”æœ‰å†…å®¹
            if (!studentNames || studentNames.length === 0) {
                // å¦‚æœæ²¡æœ‰å§“åæ•°æ®ï¼Œæ˜¾ç¤ºé»˜è®¤å†…å®¹
                ctx.fillStyle = '#FF0000'; // çº¢è‰²æ–‡æœ¬ï¼Œå¼•èµ·æ³¨æ„
                ctx.font = 'bold 36px "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('æ­£åœ¨åŠ è½½å§“åæ•°æ®...', canvas.width / 2, canvas.height / 2);
                ctx.fillStyle = '#666';
                ctx.font = '24px "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif';
                ctx.fillText('è¯·ç‚¹å‡»"å¼€å§‹ç‚¹å"æŒ‰é’®', canvas.width / 2, canvas.height / 2 + 40);
                ctx.restore();
                return;
            }
            
            // è®¾ç½®åŸºç¡€å­—ä½“æ ·å¼
            const baseFontSize = parseFloat(ctx.font) || 48;
            
            // ç»˜åˆ¶æ»šåŠ¨çš„å§“å
            for (let i = -2; i <= 2; i++) {
                const index = (currentIndex + i + studentNames.length) % studentNames.length;
                // ç¡®ä¿è·å–æœ‰æ•ˆçš„å§“å
                const name = studentNames[index] || 'æµ‹è¯•å§“å';
                const y = canvas.height / 2 + i * baseFontSize * 1.5;
                const opacity = Math.max(0.3, 1 - Math.abs(i) * 0.3); // å¢åŠ æœ€å°é€æ˜åº¦ä»¥æé«˜å¯è§æ€§
                
                // ä¸ºæ¯ä¸ªåå­—ä¿å­˜ç‹¬ç«‹çš„çŠ¶æ€
                ctx.save();
                
                // ç¡®ä¿æ–‡æœ¬å¯¹é½æ–¹å¼æ­£ç¡®
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // åŒºåˆ†ä¸åŒçŠ¶æ€ä¸‹çš„æ–‡æœ¬æ ·å¼
                if (i === 0 && !isRolling) {
                    // é€‰ä¸­çš„å§“å - ä½¿ç”¨æ›´é†’ç›®çš„é¢œè‰²å’Œæè¾¹
                    ctx.fillStyle = '#4CAF50'; // ç»¿è‰²å¡«å……
                    ctx.font = `bold ${baseFontSize * 1.1}px "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif`;
                    // æ·»åŠ æ–‡å­—æè¾¹ä»¥å¢å¼ºå¯è¯»æ€§
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1.5;
                    ctx.strokeText(name, canvas.width / 2, y);
                } else {
                    // æ”¹è¿›ï¼šæ— è®ºæ˜¯æ»šåŠ¨è¿˜æ˜¯é™æ€çŠ¶æ€ï¼Œéƒ½ç¡®ä¿åå­—å¯è§
                    if (isRolling) {
                        // æ»šåŠ¨çŠ¶æ€ä¸‹çš„åå­—ä½¿ç”¨æ›´æ˜æ˜¾çš„é¢œè‰²
                        ctx.fillStyle = 'rgba(0, 0, 0, 0.9)'; // æ·±è‰²æ–‡æœ¬ç¡®ä¿å¯è§
                    } else {
                        // éæ»šåŠ¨çŠ¶æ€ä¸‹çš„éä¸­å¿ƒåå­—
                        ctx.fillStyle = `rgba(0, 0, 0, ${opacity})`;
                    }
                    ctx.font = `${baseFontSize}px "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif`;
                }
                
                // ç»˜åˆ¶æ–‡æœ¬
                ctx.fillText(name, canvas.width / 2, y);
                
                // æ¢å¤ä¸Šä¸‹æ–‡çŠ¶æ€ä»¥é¿å…æ ·å¼æ±¡æŸ“
                ctx.restore();
            }
            
            // æ¢å¤åˆå§‹ä¸Šä¸‹æ–‡çŠ¶æ€
            ctx.restore();
        }
        
        // åŠ¨ç”»å‡½æ•° - ä¼˜åŒ–æ—¶é—´æ§åˆ¶å’Œé”™è¯¯å¤„ç†
        function animate(timestamp = 0) {
            try {
                // ç¡®ä¿canvaså’Œctxå­˜åœ¨
                if (!canvas || !ctx) {
                    console.error('Canvasæˆ–Contextæœªåˆå§‹åŒ–');
                    return;
                }
                
                // æ§åˆ¶åå­—æ»šåŠ¨é€Ÿåº¦
                if (isRolling && timestamp - lastTime >= (100 - speed)) {
                    // å½“å¤„äºæ»šåŠ¨çŠ¶æ€æ—¶ï¼Œæ›´æ–°å½“å‰ç´¢å¼•
                    lastTime = timestamp;
                    currentIndex = (currentIndex + 1) % studentNames.length;
                }
                
                // ç»˜åˆ¶å½“å‰å¸§
                draw();
                
                // è¯·æ±‚ä¸‹ä¸€å¸§
                requestAnimationFrame(animate);
            } catch (error) {
                console.error('åŠ¨ç”»å¾ªç¯ä¸­å‡ºé”™:', error);
                // å³ä½¿å‡ºé”™ä¹Ÿå°è¯•ç»§ç»­åŠ¨ç”»å¾ªç¯
                requestAnimationFrame(animate);
            }
        }
        
        // å¼€å§‹/æš‚åœæŒ‰é’®
        const startBtn = document.getElementById('startBtn');
        // æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œå¢å¼ºç¨³å®šæ€§å¹¶æ·»åŠ è°ƒè¯•ä¿¡æ¯
        startBtn.addEventListener('click', function(event) {
            event.preventDefault(); // é˜²æ­¢ä»»ä½•é»˜è®¤è¡Œä¸º
            event.stopPropagation(); // é˜²æ­¢å†’æ³¡
            
            console.log('æŒ‰é’®ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼Œå½“å‰isRollingçŠ¶æ€:', isRolling);
            
            // åˆ‡æ¢æ»šåŠ¨çŠ¶æ€
            isRolling = !isRolling;
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            try {
                startBtn.textContent = isRolling ? 'æš‚åœ' : 'å¼€å§‹ç‚¹å';
                console.log('æŒ‰é’®æ–‡æœ¬å·²æ›´æ–°:', startBtn.textContent);
            } catch (e) {
                console.error('æ›´æ–°æŒ‰é’®æ–‡æœ¬å¤±è´¥:', e);
            }
            
            // å½“åœæ­¢æ»šåŠ¨æ—¶ï¼Œè®°å½•é€‰ä¸­çš„å§“å
            if (!isRolling && studentNames && studentNames.length > 0) {
                selectedName = studentNames[currentIndex];
                console.log('é€‰ä¸­çš„å§“å:', selectedName);
                // æ˜¾ç¤ºè‡ªå®šä¹‰å¼¹çª—è€Œä¸æ˜¯alert
                showPopup(selectedName);
            }
        });
        
        // ç¡®ä¿æŒ‰é’®å¯ä»¥è¢«æ­£ç¡®ç‚¹å‡»ï¼ˆå¢å¼ºå¯è®¿é—®æ€§ï¼‰
        startBtn.style.cursor = 'pointer';
        startBtn.style.userSelect = 'none';
        
        // é€Ÿåº¦æ»‘å—
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        
        // åˆå§‹åŒ–æ»‘å—èƒŒæ™¯æ¸å˜
        const initSpeed = Number(speedSlider.value);
        const maxSpeed = Number(speedSlider.max);
        const initPercentage = (initSpeed / maxSpeed) * 100;
        speedSlider.style.background = `linear-gradient(to right, #ffb3ba 0%, #ffb3ba ${initPercentage}%, #ddd ${initPercentage}%, #ddd 100%)`;
        
        // æ»‘å—æ»‘åŠ¨äº‹ä»¶
        speedSlider.addEventListener('input', (e) => {
            speed = Number(e.target.value);
            speedValue.textContent = speed;
            // æ›´æ–°æ»‘å—èƒŒæ™¯æ¸å˜
            const max = Number(e.target.max);
            const percentage = (speed / max) * 100;
            e.target.style.background = `linear-gradient(to right, #ffb3ba 0%, #ffb3ba ${percentage}%, #ddd ${percentage}%, #ddd 100%)`;
        });
        
        // Excelå¯¼å…¥åŠŸèƒ½
        const fileInput = document.getElementById('fileInput');
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºExcelæ–‡ä»¶
                if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const data = new Uint8Array(event.target.result);
                        
                        // ç®€å•è§£æExcelæ–‡ä»¶ï¼ˆä»…æ”¯æŒåŸºæœ¬æ ¼å¼ï¼‰
                        try {
                            // ä½¿ç”¨SheetJSè§£æExcelæ–‡ä»¶
                            if (typeof XLSX !== 'undefined') {
                                const workbook = XLSX.read(data, { type: 'array' });
                                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                                const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                                
                                // æå–æ‰€æœ‰éç©ºå•å…ƒæ ¼ä½œä¸ºå§“å
                                const newNames = [];
                                jsonData.forEach(row => {
                                    row.forEach(cell => {
                                        if (cell && typeof cell === 'string' && cell.trim() !== '') {
                                            newNames.push(cell.trim());
                                        }
                                    });
                                });
                                
                                if (newNames.length > 0) {
                                    studentNames.length = 0;
                                    studentNames.push(...newNames);
                                    alert(`æˆåŠŸå¯¼å…¥ ${newNames.length} ä¸ªå§“å`);
                                } else {
                                    alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å§“åæ•°æ®');
                                }
                            } else {
                                alert('è¯·å…ˆåŠ è½½SheetJSåº“ä»¥æ”¯æŒExcelå¯¼å…¥');
                            }
                        } catch (error) {
                            alert('Excelè§£æå¤±è´¥: ' + error.message);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                } else {
                    // å¤„ç†æ–‡æœ¬æ–‡ä»¶
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const data = event.target.result;
                        const rows = data.split('\n').filter(row => row.trim() !== '');
                        const newNames = rows.map(row => row.split('\t')[0].trim()).filter(name => name !== '');
                        if (newNames.length > 0) {
                            studentNames.length = 0;
                            studentNames.push(...newNames);
                            alert(`æˆåŠŸå¯¼å…¥ ${newNames.length} ä¸ªå§“å`);
                        }
                    };
                    reader.readAsText(file);
                }
            }
        });
        
        // ä¼˜åŒ–åŠ¨ç”»åˆå§‹åŒ–ï¼Œç¡®ä¿åœ¨DOMå®Œå…¨åŠ è½½åå¯åŠ¨
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOMå†…å®¹å·²å®Œå…¨åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–åŠ¨ç”»');
            
            // ç¡®ä¿Canvaså·²å‡†å¤‡å¥½
            if (canvas && ctx) {
                console.log('Canvaså‡†å¤‡å°±ç»ªï¼Œå¯åŠ¨åŠ¨ç”»å¾ªç¯');
                
                // ç¡®ä¿studentNamesæœ‰æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ä¸€äº›é»˜è®¤æµ‹è¯•æ•°æ®
                if (!studentNames || studentNames.length === 0) {
                    console.log('æ·»åŠ é»˜è®¤æµ‹è¯•å§“åæ•°æ®');
                    const defaultNames = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'å­™ä¸ƒ', 'å‘¨å…«', 'å´ä¹', 'éƒ‘å'];
                    studentNames.push(...defaultNames);
                }
                
                // åˆå§‹åŒ–currentIndex
                currentIndex = Math.floor(Math.random() * studentNames.length);
                console.log('åˆå§‹åŒ–å½“å‰ç´¢å¼•:', currentIndex);
                
                // å¯åŠ¨åŠ¨ç”»å¾ªç¯ï¼ŒrequestAnimationFrameä¼šè‡ªåŠ¨ä¼ å…¥æ—¶é—´æˆ³
                requestAnimationFrame(animate);
            } else {
                console.error('Canvaså…ƒç´ æœªå‡†å¤‡å°±ç»ª');
            }
        });
    </script>
    <!-- å¼•å…¥SheetJSåº“ä»¥æ”¯æŒExcelå¯¼å…¥ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- å§“åç”Ÿæˆå’ŒåŠ¨ç”»é€»è¾‘å·²æ•´åˆåˆ°ä¸»è„šæœ¬å—ä¸­ -->
</body>
</html>